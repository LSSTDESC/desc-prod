<!DOCTYPE html>
<html lang="en">
<head>
<title>DESCprod help</title>
<link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
</head>
<body style="max-width:700px;color #444;">
<h2>Welcome to DESCprod</h2>
David Adams
<br>
April 2023
<br>
desc-prod 0.3.52

<h3>Introduction</h3>
DESCprod is a web service and supporting code to help users to run DESC jobs at NERSC.
<li>For an overview and status reports, please see
<ul>
<li>
<a href =https://drive.google.com/file/d/1uAMfWpQLenxF_50mjmBWqISEEDxOkdrc/view?usp=share_link>
Talk by David Adams at the January 25, 2023 DESC CO meeting</a>
</li>
<li>
<a href =https://drive.google.com/file/d/1GNceYkg1MO2_nBJoq31O2LYamXKJZYEs/view?usp=share_link>
Talk by David Adams at the March 22, 2023 DESC CO meeting</a>
</li>
</ul>

<h3>Web interface</h3>
To use the DESC web server, point your browser to <a href=https://www.descprod.org>https://www.descprod.org</a>.
<br><br>
To do more than view this document, you will need to tell us who you are.
At present, only google authentication is supported.
Click the login button and you will be taken to their page to sign in if
do not already have credentials in your browser.
If it is the first time you connect, you will have to send some info so we can link your google
and DESC IDs.
Once the link is established, login will take you to the DESCprod home page where you can submit
job and see the status of jobs submitted earlier.
<br><br>
Jobs are specified with three strings:
<ul>
<li>appname - The name of the application to run.</li>
<li>config - What to do: which input data, which processing steps, configuration prameters, ....</li>
<li>howfig - How to carry out the processing: software source, batch submission or not, job splitting, ....</li>
</ul>
Enter these on the line labeled "Create job:" to create a new job.

<br><br>
Right now, the only supported application is parsltest from <a href=https://github.com/LSSTDESC/desc-wfmon>desc-wfmon</a>.
An example config string is:
<pre>
    wq-sleep-ttsk10-ntsk20-nwrk4
</pre>
This is a request to use the WorkQueue scheduler to run 20 10-second sleep jobs using four workers.

<h3>Web interface</h3>
A job with application name APPNAME is ultimately run by calling the script runapp_APPNAME.
It is passed the config and howfig strings as arguments and is responsible for intepreting those
and running the job.
<br><br>
The job may be started on the local system by hovering over the job ID and selecting "Start job".
Resources are limited there and so please do not run more than a few tasks at a time
for more than a few minutes.
After starting, you can get status updates by refreshing the page.
Once the job is done, hover over the job ID to obtain links to archive or delete the job.
There is not much point to archive now as the jobs don't do anything too intersting and
we do no yet have the facility to retrieve them from the archive.
<br><br>
More typical operation is to start the job on a remote machine such as perlmutter.
For security reasons, you cannot yet start the job there from the server but have to log in
to the run machine issue a command there.
<br><br>
First install desc-prod on that machine, e.g. with
<pre>
module load python
cd &lt;some-dir&gt;
git clone https://github.com/LSSTDESC/desc-prod.git
pip install ./desc-prod
</pre>
The first line is to use the default python installation at NERSC.
Any recent version such as that in DESC releases is also fine.
A job may be started with <i>descprod-start-job</i> and its existence and status
can checked with <i>descprod-get-job</i>. E.g., to start and check job 1234:
<pre>
descprod-start-job 1234
descprod-get-job 1234
</pre>
If your descprod username differs from that on the local system, the former must be added
to these commands.
The server URL must also be provided if you are not using the default server.
Use -h for help on either command.

<H3>Coming soon</H3>
Our next planned deliverables include:
<ul>
<li>Configuration options so jobs will start in perlmutter.</li>
<li>Support for LSST pipeline jobs.</li>
</ul>
Stay tuned.

<br><br>
Comments and contributions are welcome.

</body>
</html>
